<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HospitalManager.MVVM.ViewModels"
             xmlns:vlxx="clr-namespace:HosipitalManager.MVVM.ViewModels"
             xmlns:views="clr-namespace:HosipitalManager.MVVM.Views"
             xmlns:micro="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="HosipitalManager.MVVM.Views.DashboardContentView">

    <Grid ColumnDefinitions="1.5*, 1*" ColumnSpacing="25">

        <Frame Grid.Column="0" 
               BackgroundColor="White" 
               CornerRadius="12" 
               Padding="10" 
               HasShadow="True" 
               HeightRequest="500" 
               BorderColor="#E0E0E0" 
               VerticalOptions="Start">

            <Grid RowDefinitions="Auto, *">
                <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="0,0,0,10">
                    <Label Text="Lịch làm việc tuần này" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           TextColor="#1D2E4E" 
                           VerticalOptions="Center"/>

                    <Button Grid.Column="1" 
                            Text="Làm mới" 
                            Clicked="RefreshCalendar_Clicked" 
                            FontSize="12" 
                            HeightRequest="30" 
                            Padding="10,0" 
                            BackgroundColor="#F3F4F6" 
                            TextColor="#1D2E4E"
                            CornerRadius="6"/>
                </Grid>

                <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Always">
                    <Grid x:Name="ScheduleGrid" RowSpacing="1" ColumnSpacing="1" BackgroundColor="#F0F0F0">
                    </Grid>
                </ScrollView>
            </Grid>
        </Frame>

        <Frame Grid.Column="1" 
               BackgroundColor="White" 
               CornerRadius="12" 
               Padding="20" 
               HasShadow="True" 
               HeightRequest="500"
               BorderColor="#E0E0E0"
               VerticalOptions="Start">

            <VerticalStackLayout Spacing="15">
                <Grid ColumnDefinitions="*, Auto">
                    <Label Text="Hàng đợi chờ khám" FontSize="18" FontAttributes="Bold" TextColor="#1D2E4E" VerticalOptions="Center"/>
                    <Button Grid.Column="1" Text="+ Tiếp nhận" 
                                Command="{Binding ShowAddPatientPopupCommand}"
                                BackgroundColor="{StaticResource ColorPrimary}" TextColor="White" 
                                HeightRequest="35" Padding="15,0" CornerRadius="8" FontSize="12"/>
                </Grid>

                <CollectionView ItemsSource="{Binding WaitingQueue}" EmptyView="Hiện chưa có bệnh nhân nào trong hàng đợi.">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="1" Padding="10">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BackgroundColor" Value="White"/>
                                        <Setter Property="Stroke" Value="#E5E7EB"/>
                                        <Style.Triggers>
                                            <DataTrigger TargetType="Border" Binding="{Binding Severity}" Value="critical">
                                                <Setter Property="BackgroundColor" Value="#FEF2F2"/>
                                                <Setter Property="Stroke" Value="#EF4444"/>
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border" Binding="{Binding Severity}" Value="emergency">
                                                <Setter Property="BackgroundColor" Value="#FFF7ED"/>
                                                <Setter Property="Stroke" Value="#F97316"/>
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border" Binding="{Binding Severity}" Value="urgent">
                                                <Setter Property="BackgroundColor" Value="#FEFCE8"/>
                                                <Setter Property="Stroke" Value="#EAB308"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>

                                <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="15">
                                    <Border WidthRequest="40" HeightRequest="40" StrokeShape="RoundRectangle 20" BackgroundColor="Transparent" StrokeThickness="0" VerticalOptions="Center">
                                        <Label Text="{Binding PriorityScore, StringFormat='{0:F0}'}" 
                                    TextColor="#1D2E4E" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                        <Label Text="{Binding FullName}" FontAttributes="Bold" FontSize="14" TextColor="#1F2937"/>
                                        <Label Text="{Binding Symptoms}" FontSize="12" TextColor="#6B7280" LineBreakMode="TailTruncation"/>
                                    </VerticalStackLayout>

                                    <Button Grid.Column="2" 
                                        Text="Gọi" 
                                        FontSize="12" 
                                        HeightRequest="30" 
                                        Padding="10,0" 
                                        CornerRadius="5" 
                                        BackgroundColor="#1D2E4E" 
                                        TextColor="White"
        
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:DashboardViewModel}}, Path=CallPatientCommand}"
                                        CommandParameter="{Binding .}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </Frame>
    </Grid>
</ContentView>